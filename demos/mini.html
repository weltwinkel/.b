<!DOCTYPE html>
<head>
    <title>databinding</title>
<script src="ext/jquery.js"></script>
<script src="../src/b.js"></script>
<script src="../src/b.binders.js"></script>
<script src="../src/b.formatters.js"></script>
<script src="../src/jQuery_b.js"></script>
</head>
<body>
<script>

// create objects
var devices = []; // create array where all devices are stored

var device = function(parameters){
	obj = this; // get instance
	for(var key in parameters){ // loop attributes
		obj[ key ] = parameters[ key ]; // set attribute
		obj["foo.bar"] = "hello";
	}
	
	obj.id = devices.length;
	devices.push(obj);
};
	
// create the devices
var d = new device({alias : "Device 1", status : 2});
var t1 = new b.template();
var t2 = new b.template();
var t3 = new b.template();
var t4 = new b.template();

b.formatters.err = function(params){
	console.log(params);
	var stat;
	switch(params[0].object[ params[0].param ]){
		case 0: stat = "OK"; break;
		case 1: stat = "GuessOk"; break;
		case 2: stat = "Unknown"; break;
		case 3: stat = "Warning"; break;
		case 4: stat = "Minor"; break;
		case 5: stat = "Major"; break;
		case 6: stat = "Critical"; break;
	}
	
	params.formatted = stat; // add formatted value
	return params; // return object
};
var arr = [1,2,3,4,5,6];

$(function(){

	// loop devices and create them using jQuery_b
	$("<span>").b({class : "dev.status|test:err", html : "dev.status:err"},{dev : d, test : arr},t1).appendTo("body");
	//$("<span>").b({class : "dev.status:err", html : "dev.status:err"},{dev : d},t2).appendTo("body");
	//$("<span>").b({class : "dev.status:err", html : "dev.status:err"},{dev : d},t3).appendTo("body");
	//$("<span>").b({class : "dev.status:err", html : "dev.status:err"},{dev : d},t4).appendTo("body");
	
});


window.setInterval(function(){

	devices.forEach(function(device){
		var stat = Math.round(Math.random()*6);
		device._set("status", stat );
		});
	},5000);

</script>
<style>
span{padding:10px; display:inline-block;}

.OK{background-color:#d1ee63 !important}
.GuessOk{background-color:#eeffaa !important}
.Unknown{background-color:#f2f2f2 !important}
.Warning{background-color:#ffff80 !important}
.Minor{background-color:#fdc375 !important}
.Major{background-color:#ff8a8a !important}
.Critical{background-color:#ff5555 !important}

</style>
</body>
</html>